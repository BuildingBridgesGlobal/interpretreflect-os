"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9279:(e,t,s)=>{let r,n,i;s.r(t),s.d(t,{originalPathname:()=>sS,patchFetch:()=>sx,requestAsyncStorage:()=>s_,routeModule:()=>sw,serverHooks:()=>sk,staticGenerationAsyncStorage:()=>sv});var a,o,l,c,h,u,d,p,f,m,g,y,b,w,_,v,k,S,x,R,E,$,P,A,M,T,I,O,N,L,j,q,C,W,D,U,B,F,H,X,K,J,Y,z,V,G,Q,Z,ee,et,es,er,en,ei,ea,eo,el,ec,eh,eu,ed,ep,ef,em,eg,ey={};s.r(ey),s.d(ey,{POST:()=>sb});var eb=s(9303),ew=s(8716),e_=s(670),ev=s(7070);function ek(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function eS(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}let ex=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ex=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function eR(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eE=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class e$ extends Error{}class eP extends e${constructor(e,t,s,r){super(`${eP.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("request-id"),this.error=t}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){return e&&r?400===e?new eI(e,t,s,r):401===e?new eO(e,t,s,r):403===e?new eN(e,t,s,r):404===e?new eL(e,t,s,r):409===e?new ej(e,t,s,r):422===e?new eq(e,t,s,r):429===e?new eC(e,t,s,r):e>=500?new eW(e,t,s,r):new eP(e,t,s,r):new eM({message:s,cause:eE(t)})}}class eA extends eP{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eM extends eP{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eT extends eM{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eI extends eP{}class eO extends eP{}class eN extends eP{}class eL extends eP{}class ej extends eP{}class eq extends eP{}class eC extends eP{}class eW extends eP{}let eD=/^[a-z][a-z0-9+.-]*:/i,eU=e=>eD.test(e),eB=e=>(eB=Array.isArray)(e),eF=eB;function eH(e){return"object"!=typeof e?{}:e??{}}let eX=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new e$(`${e} must be an integer`);if(t<0)throw new e$(`${e} must be a positive integer`);return t},eK=e=>{try{return JSON.parse(e)}catch(e){return}},eJ=e=>new Promise(t=>setTimeout(t,e)),eY="0.71.0",ez=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,eV=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eY,"X-Stainless-OS":eQ(Deno.build.os),"X-Stainless-Arch":eG(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eY,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eY,"X-Stainless-OS":eQ(globalThis.process.platform??"unknown"),"X-Stainless-Arch":eG(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eY,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eY,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},eG=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",eQ=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",eZ=()=>r??(r=eV());function e0(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function e1(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return e0({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function e2(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function e4(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let e5=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});function e3(e){let t;return(n??(n=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function e6(e){let t;return(i??(i=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class e9{constructor(){a.set(this,void 0),o.set(this,void 0),ek(this,a,new Uint8Array,"f"),ek(this,o,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?e3(e):e;ek(this,a,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([eS(this,a,"f"),s]),"f");let r=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eS(this,a,"f"),eS(this,o,"f")));){if(t.carriage&&null==eS(this,o,"f")){ek(this,o,t.index,"f");continue}if(null!=eS(this,o,"f")&&(t.index!==eS(this,o,"f")+1||t.carriage)){r.push(e6(eS(this,a,"f").subarray(0,eS(this,o,"f")-1))),ek(this,a,eS(this,a,"f").subarray(eS(this,o,"f")),"f"),ek(this,o,null,"f");continue}let e=null!==eS(this,o,"f")?t.preceding-1:t.preceding,s=e6(eS(this,a,"f").subarray(0,e));r.push(s),ek(this,a,eS(this,a,"f").subarray(t.index),"f"),ek(this,o,null,"f")}return r}flush(){return eS(this,a,"f").length?this.decode("\n"):[]}}a=new WeakMap,o=new WeakMap,e9.NEWLINE_CHARS=new Set(["\n","\r"]),e9.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let e8={off:0,error:200,warn:300,info:400,debug:500},e7=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(e8,e))return e;tn(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(e8))}`)}};function te(){}function tt(e,t,s){return!t||e8[e]>e8[s]?te:t[e].bind(t)}let ts={error:te,warn:te,info:te,debug:te},tr=new WeakMap;function tn(e){let t=e.logger,s=e.logLevel??"off";if(!t)return ts;let r=tr.get(t);if(r&&r[0]===s)return r[1];let n={error:tt("error",t,s),warn:tt("warn",t,s),info:tt("info",t,s),debug:tt("debug",t,s)};return tr.set(t,[s,n]),n}let ti=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class ta{constructor(e,t,s){this.iterator=e,l.set(this,void 0),this.controller=t,ek(this,l,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?tn(s):console;return new ta(async function*(){if(r)throw new e$("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let s of to(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw new eP(void 0,eK(s.data)??s.data,void 0,e.headers)}s=!0}catch(e){if(eR(e))return;throw e}finally{s||t.abort()}},t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new e9;for await(let s of e2(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new ta(async function*(){if(r)throw new e$("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eR(e))return;throw e}finally{e||t.abort()}},t,s)}[(l=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new ta(()=>r(e),this.controller,eS(this,l,"f")),new ta(()=>r(t),this.controller,eS(this,l,"f"))]}toReadableStream(){let e;let t=this;return e0({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=e3(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*to(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new e$("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new e$("Attempted to iterate over a response with no body")}let s=new tc,r=new e9;for await(let t of tl(e2(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*tl(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?e3(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tc{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),":",e.substring(s+t.length)]:[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function th(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tn(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):ta.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?tu(await s.json(),s):await s.text()})();return tn(e).debug(`[${r}] response parsed`,ti({retryOfRequestLogID:n,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tu(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class td extends Promise{constructor(e,t,s=th){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,c.set(this,void 0),ek(this,c,e,"f")}_thenUnwrap(e){return new td(eS(this,c,"f"),this.responsePromise,async(t,s)=>tu(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eS(this,c,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}c=new WeakMap;class tp{constructor(e,t,s,r){h.set(this,void 0),ek(this,h,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new e$("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eS(this,h,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(h=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tf extends td{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await th(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tm extends tp{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let e=this.first_id;return e?{...this.options,query:{...eH(this.options.query),before_id:e}}:null}let e=this.last_id;return e?{...this.options,query:{...eH(this.options.query),after_id:e}}:null}}class tg extends tp{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.next_page=s.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...eH(this.options.query),page:e}}:null}}let ty=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tb(e,t,s){return ty(),new File(e,t??"unknown_file",s)}function tw(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let t_=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tv=async(e,t)=>({...e,body:await tS(e.body,t)}),tk=new WeakMap,tS=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tk.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tk.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>t$(s,e,t))),s},tx=e=>e instanceof Blob&&"name"in e,tR=e=>"object"==typeof e&&null!==e&&(e instanceof Response||t_(e)||tx(e)),tE=e=>{if(tR(e))return!0;if(Array.isArray(e))return e.some(tE);if(e&&"object"==typeof e){for(let t in e)if(tE(e[t]))return!0}return!1},t$=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let r={},n=s.headers.get("Content-Type");n&&(r={type:n}),e.append(t,tb([await s.blob()],tw(s),r))}else if(t_(s))e.append(t,tb([await new Response(e1(s)).blob()],tw(s)));else if(tx(s))e.append(t,tb([s],tw(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>t$(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>t$(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tP=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,tA=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tP(e),tM=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function tT(e,t,s){if(ty(),e=await e,t||(t=tw(e)),tA(e))return e instanceof File&&null==t&&null==s?e:tb([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if(tM(e)){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tb(await tI(r),t,s)}let r=await tI(e);if(!s?.type){let e=r.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tb(r,t,s)}async function tI(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tP(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(t_(e))for await(let s of e)t.push(...await tI(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class tO{constructor(e){this._client=e}}let tN=Symbol.for("brand.privateNullableHeaders"),tL=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,i]of function*(e){let t;if(!e)return;if(tN in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():eF(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=eF(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===i?(t.delete(n),s.add(r)):(t.append(n,i),s.delete(r))}}return{[tN]:!0,values:t,nulls:s}};function tj(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tq=Object.freeze(Object.create(null)),tC=((e=tj)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,i=[],a=t.reduce((t,r,a)=>{/[?#]/.test(r)&&(n=!0);let o=s[a],l=(n?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tq)??tq)?.toString)&&(l=o+"",i.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)i.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new e$(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(tj);class tW extends tO{list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/files",tm,{query:r,...t,headers:tL([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tC`/v1/files/${e}`,{...s,headers:tL([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/files/${e}/content`,{...s,headers:tL([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/files/${e}`,{...s,headers:tL([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){let{betas:s,...r}=e;return this._client.post("/v1/files",tv({body:r,...t,headers:tL([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}class tD extends tO{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/models/${e}?beta=true`,{...s,headers:tL([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",tm,{query:r,...t,headers:tL([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let tU={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function tB(e,t){return t&&"parse"in(t.output_format??{})?tF(e,t):{...e,content:e.content.map(e=>"text"===e.type?{...e,parsed:null}:e),parsed_output:null}}function tF(e,t){let s=null,r=e.content.map(e=>{if("text"===e.type){let r=function(e,t){if(e.output_format?.type!=="json_schema")return null;try{if("parse"in e.output_format)return e.output_format.parse(t);return JSON.parse(t)}catch(e){throw new e$(`Failed to parse structured output: ${e}`)}}(t,e.text);return null===s&&(s=r),{...e,parsed:r}}return e});return{...e,content:r,parsed_output:s}}let tH=e=>{let t=0,s=[];for(;t<e.length;){let r=e[t];if("\\"===r){t++;continue}if("{"===r){s.push({type:"brace",value:"{"}),t++;continue}if("}"===r){s.push({type:"brace",value:"}"}),t++;continue}if("["===r){s.push({type:"paren",value:"["}),t++;continue}if("]"===r){s.push({type:"paren",value:"]"}),t++;continue}if(":"===r){s.push({type:"separator",value:":"}),t++;continue}if(","===r){s.push({type:"delimiter",value:","}),t++;continue}if('"'===r){let n="",i=!1;for(r=e[++t];'"'!==r;){if(t===e.length){i=!0;break}if("\\"===r){if(++t===e.length){i=!0;break}n+=r+e[t],r=e[++t]}else n+=r,r=e[++t]}r=e[++t],i||s.push({type:"string",value:n});continue}let n=/\s/;if(r&&n.test(r)){t++;continue}let i=/[0-9]/;if(r&&i.test(r)||"-"===r||"."===r){let n="";for("-"===r&&(n+=r,r=e[++t]);r&&i.test(r)||"."===r;)n+=r,r=e[++t];s.push({type:"number",value:n});continue}let a=/[a-z]/i;if(r&&a.test(r)){let n="";for(;r&&a.test(r)&&t!==e.length;)n+=r,r=e[++t];"true"==n||"false"==n||"null"===n?s.push({type:"name",value:n}):t++;continue}t++}return s},tX=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return tX(e=e.slice(0,e.length-1));case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return tX(e=e.slice(0,e.length-1));case"string":let r=e[e.length-2];if(r?.type==="delimiter"||r?.type==="brace"&&"{"===r.value)return tX(e=e.slice(0,e.length-1));break;case"delimiter":return tX(e=e.slice(0,e.length-1))}return e},tK=e=>{let t=[];return e.map(e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))}),t.length>0&&t.reverse().map(t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})}),e},tJ=e=>{let t="";return e.map(e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value}),t},tY=e=>JSON.parse(tJ(tK(tX(tH(e))))),tz="__json_buf";function tV(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class tG{constructor(e){u.add(this),this.messages=[],this.receivedMessages=[],d.set(this,void 0),p.set(this,null),this.controller=new AbortController,f.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,void 0),b.set(this,()=>{}),w.set(this,()=>{}),_.set(this,{}),v.set(this,!1),k.set(this,!1),S.set(this,!1),x.set(this,!1),R.set(this,void 0),E.set(this,void 0),A.set(this,e=>{if(ek(this,k,!0,"f"),eR(e)&&(e=new eA),e instanceof eA)return ek(this,S,!0,"f"),this._emit("abort",e);if(e instanceof e$)return this._emit("error",e);if(e instanceof Error){let t=new e$(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new e$(String(e)))}),ek(this,f,new Promise((e,t)=>{ek(this,m,e,"f"),ek(this,g,t,"f")}),"f"),ek(this,y,new Promise((e,t)=>{ek(this,b,e,"f"),ek(this,w,t,"f")}),"f"),eS(this,f,"f").catch(()=>{}),eS(this,y,"f").catch(()=>{}),ek(this,p,e,"f")}get response(){return eS(this,R,"f")}get request_id(){return eS(this,E,"f")}async withResponse(){let e=await eS(this,f,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new tG(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){let r=new tG(t);for(let e of t.messages)r._addMessageParam(e);return ek(r,p,{...t,stream:!0},"f"),r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},eS(this,A,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{eS(this,u,"m",M).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))eS(this,u,"m",T).call(this,e);if(n.controller.signal?.aborted)throw new eA;eS(this,u,"m",I).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(ek(this,R,e,"f"),ek(this,E,e?.headers.get("request-id"),"f"),eS(this,m,"f").call(this,e),this._emit("connect"))}get ended(){return eS(this,v,"f")}get errored(){return eS(this,k,"f")}get aborted(){return eS(this,S,"f")}abort(){this.controller.abort()}on(e,t){return(eS(this,_,"f")[e]||(eS(this,_,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eS(this,_,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(eS(this,_,"f")[e]||(eS(this,_,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{ek(this,x,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){ek(this,x,!0,"f"),await eS(this,y,"f")}get currentMessage(){return eS(this,d,"f")}async finalMessage(){return await this.done(),eS(this,u,"m",$).call(this)}async finalText(){return await this.done(),eS(this,u,"m",P).call(this)}_emit(e,...t){if(eS(this,v,"f"))return;"end"===e&&(ek(this,v,!0,"f"),eS(this,b,"f").call(this));let s=eS(this,_,"f")[e];if(s&&(eS(this,_,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eS(this,x,"f")||s?.length||Promise.reject(e),eS(this,g,"f").call(this,e),eS(this,w,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eS(this,x,"f")||s?.length||Promise.reject(e),eS(this,g,"f").call(this,e),eS(this,w,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",eS(this,u,"m",$).call(this))}async _fromReadableStream(e,t){let s;let r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{eS(this,u,"m",M).call(this),this._connected(null);let t=ta.fromReadableStream(e,this.controller);for await(let e of t)eS(this,u,"m",T).call(this,e);if(t.controller.signal?.aborted)throw new eA;eS(this,u,"m",I).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap,_=new WeakMap,v=new WeakMap,k=new WeakMap,S=new WeakMap,x=new WeakMap,R=new WeakMap,E=new WeakMap,A=new WeakMap,u=new WeakSet,$=function(){if(0===this.receivedMessages.length)throw new e$("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},P=function(){if(0===this.receivedMessages.length)throw new e$("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new e$("stream ended without producing a content block with type=text");return e.join(" ")},M=function(){this.ended||ek(this,d,void 0,"f")},T=function(e){if(this.ended)return;let t=eS(this,u,"m",O).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":tV(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(tB(t,eS(this,p,"f")),!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":ek(this,d,t,"f")}},I=function(){if(this.ended)throw new e$("stream has ended, this shouldn't happen");let e=eS(this,d,"f");if(!e)throw new e$("request ended without sending any chunks");return ek(this,d,void 0,"f"),tB(e,eS(this,p,"f"))},O=function(e){let t=eS(this,d,"f");if("message_start"===e.type){if(t)throw new e$(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new e$(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t.context_management=e.context_management,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&tV(s)){let r=s[tz]||"";r+=e.delta.partial_json;let n={...s};if(Object.defineProperty(n,tz,{value:r,enumerable:!1,writable:!0}),r)try{n.input=tY(r)}catch(t){let e=new e$(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${t}. JSON: ${r}`);eS(this,A,"f").call(this,e)}t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:e.delta}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ta(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let tQ=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeâ€”err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;function tZ(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}class t0{constructor(e,t,s){N.add(this),this.client=e,L.set(this,!1),j.set(this,!1),q.set(this,void 0),C.set(this,void 0),W.set(this,void 0),D.set(this,void 0),U.set(this,void 0),B.set(this,0),ek(this,q,{params:{...t,messages:structuredClone(t.messages)}},"f"),ek(this,C,{...s,headers:tL([{"x-stainless-helper":"BetaToolRunner"},s?.headers])},"f"),ek(this,U,tZ(),"f")}async *[(L=new WeakMap,j=new WeakMap,q=new WeakMap,C=new WeakMap,W=new WeakMap,D=new WeakMap,U=new WeakMap,B=new WeakMap,N=new WeakSet,F=async function(){let e=eS(this,q,"f").params.compactionControl;if(!e||!e.enabled)return!1;let t=0;if(void 0!==eS(this,W,"f"))try{let e=await eS(this,W,"f");t=e.usage.input_tokens+(e.usage.cache_creation_input_tokens??0)+(e.usage.cache_read_input_tokens??0)+e.usage.output_tokens}catch{return!1}if(t<(e.contextTokenThreshold??1e5))return!1;let s=e.model??eS(this,q,"f").params.model,r=e.summaryPrompt??tQ,n=eS(this,q,"f").params.messages;if("assistant"===n[n.length-1].role){let e=n[n.length-1];if(Array.isArray(e.content)){let t=e.content.filter(e=>"tool_use"!==e.type);0===t.length?n.pop():e.content=t}}let i=await this.client.beta.messages.create({model:s,messages:[...n,{role:"user",content:[{type:"text",text:r}]}],max_tokens:eS(this,q,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(i.content[0]?.type!=="text")throw new e$("Expected text response for compaction");return eS(this,q,"f").params.messages=[{role:"user",content:i.content}],!0},Symbol.asyncIterator)](){var e;if(eS(this,L,"f"))throw new e$("Cannot iterate over a consumed stream");ek(this,L,!0,"f"),ek(this,j,!0,"f"),ek(this,D,void 0,"f");try{for(;;){let t;try{if(eS(this,q,"f").params.max_iterations&&eS(this,B,"f")>=eS(this,q,"f").params.max_iterations)break;ek(this,j,!1,"f"),ek(this,D,void 0,"f"),ek(this,B,(e=eS(this,B,"f"),++e),"f"),ek(this,W,void 0,"f");let{max_iterations:s,compactionControl:r,...n}=eS(this,q,"f").params;if(n.stream?(t=this.client.beta.messages.stream({...n},eS(this,C,"f")),ek(this,W,t.finalMessage(),"f"),eS(this,W,"f").catch(()=>{}),yield t):(ek(this,W,this.client.beta.messages.create({...n,stream:!1},eS(this,C,"f")),"f"),yield eS(this,W,"f")),!await eS(this,N,"m",F).call(this)){if(!eS(this,j,"f")){let{role:e,content:t}=await eS(this,W,"f");eS(this,q,"f").params.messages.push({role:e,content:t})}let e=await eS(this,N,"m",H).call(this,eS(this,q,"f").params.messages.at(-1));if(e)eS(this,q,"f").params.messages.push(e);else if(!eS(this,j,"f"))break}}finally{t&&t.abort()}}if(!eS(this,W,"f"))throw new e$("ToolRunner concluded without a message from the server");eS(this,U,"f").resolve(await eS(this,W,"f"))}catch(e){throw ek(this,L,!1,"f"),eS(this,U,"f").promise.catch(()=>{}),eS(this,U,"f").reject(e),ek(this,U,tZ(),"f"),e}}setMessagesParams(e){"function"==typeof e?eS(this,q,"f").params=e(eS(this,q,"f").params):eS(this,q,"f").params=e,ek(this,j,!0,"f"),ek(this,D,void 0,"f")}async generateToolResponse(){let e=await eS(this,W,"f")??this.params.messages.at(-1);return e?eS(this,N,"m",H).call(this,e):null}done(){return eS(this,U,"f").promise}async runUntilDone(){if(!eS(this,L,"f"))for await(let e of this);return this.done()}get params(){return eS(this,q,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}async function t1(e,t=e.messages.at(-1)){if(!t||"assistant"!==t.role||!t.content||"string"==typeof t.content)return null;let s=t.content.filter(e=>"tool_use"===e.type);return 0===s.length?null:{role:"user",content:await Promise.all(s.map(async t=>{let s=e.tools.find(e=>("name"in e?e.name:e.mcp_server_name)===t.name);if(!s||!("run"in s))return{type:"tool_result",tool_use_id:t.id,content:`Error: Tool '${t.name}' not found`,is_error:!0};try{let e=t.input;"parse"in s&&s.parse&&(e=s.parse(e));let r=await s.run(e);return{type:"tool_result",tool_use_id:t.id,content:r}}catch(e){return{type:"tool_result",tool_use_id:t.id,content:`Error: ${e instanceof Error?e.message:String(e)}`,is_error:!0}}}))}}H=async function(e){return void 0!==eS(this,D,"f")||ek(this,D,t1(eS(this,q,"f").params,e),"f"),eS(this,D,"f")};class t2{constructor(e,t){this.iterator=e,this.controller=t}async *decoder(){let e=new e9;for await(let t of this.iterator)for(let s of e.decode(t))yield JSON.parse(s);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new e$("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new e$("Attempted to iterate over a response with no body")}return new t2(e2(e.body),t)}}class t4 extends tO{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:tL([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/messages/batches/${e}?beta=true`,{...s,headers:tL([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",tm,{query:r,...t,headers:tL([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tC`/v1/messages/batches/${e}?beta=true`,{...s,headers:tL([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){let{betas:r}=t??{};return this._client.post(tC`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:tL([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){let r=await this.retrieve(e);if(!r.results_url)throw new e$(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);let{betas:n}=t??{};return this._client.get(r.results_url,{...s,headers:tL([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>t2.fromResponse(t.response,t.controller))}}let t5={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};class t3 extends tO{constructor(){super(...arguments),this.batches=new t4(this._client)}create(e,t){let{betas:s,...r}=e;r.model in t5&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${t5[r.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!r.stream&&null==n){let e=tU[r.model]??void 0;n=this._client.calculateNonstreamingTimeout(r.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:r,timeout:n??6e5,...t,headers:tL([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:tL([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(t=>tF(t,e))}stream(e,t){return tG.createMessage(this,e,t)}countTokens(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:tL([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new t0(this._client,e,t)}}t3.Batches=t4,t3.BetaToolRunner=t0;class t6 extends tO{create(e,t={},s){let{betas:r,...n}=t??{};return this._client.post(tC`/v1/skills/${e}/versions?beta=true`,tv({body:n,...s,headers:tL([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])},this._client))}retrieve(e,t,s){let{skill_id:r,betas:n}=t;return this._client.get(tC`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tL([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e,t={},s){let{betas:r,...n}=t??{};return this._client.getAPIList(tC`/v1/skills/${e}/versions?beta=true`,tg,{query:n,...s,headers:tL([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}delete(e,t,s){let{skill_id:r,betas:n}=t;return this._client.delete(tC`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tL([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}}class t9 extends tO{constructor(){super(...arguments),this.versions=new t6(this._client)}create(e={},t){let{betas:s,...r}=e??{};return this._client.post("/v1/skills?beta=true",tv({body:r,...t,headers:tL([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/skills/${e}?beta=true`,{...s,headers:tL([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/skills?beta=true",tg,{query:r,...t,headers:tL([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tC`/v1/skills/${e}?beta=true`,{...s,headers:tL([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}}t9.Versions=t6;class t8 extends tO{constructor(){super(...arguments),this.models=new tD(this._client),this.messages=new t3(this._client),this.files=new tW(this._client),this.skills=new t9(this._client)}}t8.Models=tD,t8.Messages=t3,t8.Files=tW,t8.Skills=t9;class t7 extends tO{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:tL([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}let se="__json_buf";function st(e){return"tool_use"===e.type||"server_tool_use"===e.type}class ss{constructor(){X.add(this),this.messages=[],this.receivedMessages=[],K.set(this,void 0),this.controller=new AbortController,J.set(this,void 0),Y.set(this,()=>{}),z.set(this,()=>{}),V.set(this,void 0),G.set(this,()=>{}),Q.set(this,()=>{}),Z.set(this,{}),ee.set(this,!1),et.set(this,!1),es.set(this,!1),er.set(this,!1),en.set(this,void 0),ei.set(this,void 0),el.set(this,e=>{if(ek(this,et,!0,"f"),eR(e)&&(e=new eA),e instanceof eA)return ek(this,es,!0,"f"),this._emit("abort",e);if(e instanceof e$)return this._emit("error",e);if(e instanceof Error){let t=new e$(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new e$(String(e)))}),ek(this,J,new Promise((e,t)=>{ek(this,Y,e,"f"),ek(this,z,t,"f")}),"f"),ek(this,V,new Promise((e,t)=>{ek(this,G,e,"f"),ek(this,Q,t,"f")}),"f"),eS(this,J,"f").catch(()=>{}),eS(this,V,"f").catch(()=>{})}get response(){return eS(this,en,"f")}get request_id(){return eS(this,ei,"f")}async withResponse(){let e=await eS(this,J,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new ss;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){let r=new ss;for(let e of t.messages)r._addMessageParam(e);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},eS(this,el,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{eS(this,X,"m",ec).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))eS(this,X,"m",eh).call(this,e);if(n.controller.signal?.aborted)throw new eA;eS(this,X,"m",eu).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(ek(this,en,e,"f"),ek(this,ei,e?.headers.get("request-id"),"f"),eS(this,Y,"f").call(this,e),this._emit("connect"))}get ended(){return eS(this,ee,"f")}get errored(){return eS(this,et,"f")}get aborted(){return eS(this,es,"f")}abort(){this.controller.abort()}on(e,t){return(eS(this,Z,"f")[e]||(eS(this,Z,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eS(this,Z,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(eS(this,Z,"f")[e]||(eS(this,Z,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{ek(this,er,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){ek(this,er,!0,"f"),await eS(this,V,"f")}get currentMessage(){return eS(this,K,"f")}async finalMessage(){return await this.done(),eS(this,X,"m",ea).call(this)}async finalText(){return await this.done(),eS(this,X,"m",eo).call(this)}_emit(e,...t){if(eS(this,ee,"f"))return;"end"===e&&(ek(this,ee,!0,"f"),eS(this,G,"f").call(this));let s=eS(this,Z,"f")[e];if(s&&(eS(this,Z,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eS(this,er,"f")||s?.length||Promise.reject(e),eS(this,z,"f").call(this,e),eS(this,Q,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eS(this,er,"f")||s?.length||Promise.reject(e),eS(this,z,"f").call(this,e),eS(this,Q,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",eS(this,X,"m",ea).call(this))}async _fromReadableStream(e,t){let s;let r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{eS(this,X,"m",ec).call(this),this._connected(null);let t=ta.fromReadableStream(e,this.controller);for await(let e of t)eS(this,X,"m",eh).call(this,e);if(t.controller.signal?.aborted)throw new eA;eS(this,X,"m",eu).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(K=new WeakMap,J=new WeakMap,Y=new WeakMap,z=new WeakMap,V=new WeakMap,G=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,er=new WeakMap,en=new WeakMap,ei=new WeakMap,el=new WeakMap,X=new WeakSet,ea=function(){if(0===this.receivedMessages.length)throw new e$("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},eo=function(){if(0===this.receivedMessages.length)throw new e$("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new e$("stream ended without producing a content block with type=text");return e.join(" ")},ec=function(){this.ended||ek(this,K,void 0,"f")},eh=function(e){if(this.ended)return;let t=eS(this,X,"m",ed).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":st(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":ek(this,K,t,"f")}},eu=function(){if(this.ended)throw new e$("stream has ended, this shouldn't happen");let e=eS(this,K,"f");if(!e)throw new e$("request ended without sending any chunks");return ek(this,K,void 0,"f"),e},ed=function(e){let t=eS(this,K,"f");if("message_start"===e.type){if(t)throw new e$(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new e$(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push({...e.content_block}),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&st(s)){let r=s[se]||"";r+=e.delta.partial_json;let n={...s};Object.defineProperty(n,se,{value:r,enumerable:!1,writable:!0}),r&&(n.input=tY(r)),t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:e.delta}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ta(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class sr extends tO{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(tC`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",tm,{query:e,...t})}delete(e,t){return this._client.delete(tC`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(tC`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let s=await this.retrieve(e);if(!s.results_url)throw new e$(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:tL([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>t2.fromResponse(t.response,t.controller))}}class sn extends tO{constructor(){super(...arguments),this.batches=new sr(this._client)}create(e,t){e.model in si&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${si[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&null==s){let t=tU[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return ss.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}let si={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};sn.Batches=sr;class sa extends tO{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/models/${e}`,{...s,headers:tL([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models",tm,{query:r,...t,headers:tL([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let so=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sl{constructor({baseURL:e=so("ANTHROPIC_BASE_URL"),apiKey:t=so("ANTHROPIC_API_KEY")??null,authToken:s=so("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){ep.add(this),em.set(this,void 0);let n={apiKey:t,authToken:s,...r,baseURL:e||"https://api.anthropic.com"};if(!n.dangerouslyAllowBrowser&&ez())throw new e$("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=n.baseURL,this.timeout=n.timeout??ef.DEFAULT_TIMEOUT,this.logger=n.logger??console;let i="warn";this.logLevel=i,this.logLevel=e7(n.logLevel,"ClientOptions.logLevel",this)??e7(so("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=n.fetchOptions,this.maxRetries=n.maxRetries??2,this.fetch=n.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),ek(this,em,e5,"f"),this._options=n,this.apiKey="string"==typeof t?t:null,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization")||this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization")||t.has("authorization")))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return tL([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return tL([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return tL([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new e$(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${eY}`}defaultIdempotencyKey(){return`stainless-node-retry-${ex()}`}makeStatusError(e,t,s,r){return eP.generate(e,t,s,r)}buildURL(e,t,s){let r=!eS(this,ep,"m",eg).call(this)&&s||this.baseURL,n=new URL(eU(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new e$("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new td(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(i,{url:a,options:r});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(tn(this).debug(`[${l}] sending request`,ti({retryOfRequestLogID:s,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new eA;let u=new AbortController,d=await this.fetchWithTimeout(a,i,o,u).catch(eE),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new eA;let n=eR(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tn(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),tn(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,ti({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),this.retryRequest(r,t,s??l);if(tn(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),tn(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,ti({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),n)throw new eT;throw new eM({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-h}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await e4(d.body),tn(this).info(`${m} - ${e}`),tn(this).debug(`[${l}] response error (${e})`,ti({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";tn(this).info(`${m} - ${n}`);let i=await d.text().catch(e=>eE(e).message),a=eK(i),o=a?void 0:i;throw tn(this).debug(`[${l}] response error (${n})`,ti({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,a,o,d.headers)}return tn(this).info(m),tn(this).debug(`[${l}] response start`,ti({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),{response:d,options:r,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tf(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:i,...a}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,r){let n;let i=r?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let a=r?.get("retry-after");if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await eJ(n),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||null!=t&&e>t)throw new e$("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:i,defaultBaseURL:a}=s,o=this.buildURL(n,i,a);"timeout"in s&&eX("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let i=tL([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...eZ(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=tL([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:e1(e)}:eS(this,em,"f").call(this,{body:e,headers:s})}}ef=sl,em=new WeakMap,ep=new WeakSet,eg=function(){return"https://api.anthropic.com"!==this.baseURL},sl.Anthropic=ef,sl.HUMAN_PROMPT="\\n\\nHuman:",sl.AI_PROMPT="\\n\\nAssistant:",sl.DEFAULT_TIMEOUT=6e5,sl.AnthropicError=e$,sl.APIError=eP,sl.APIConnectionError=eM,sl.APIConnectionTimeoutError=eT,sl.APIUserAbortError=eA,sl.NotFoundError=eL,sl.ConflictError=ej,sl.RateLimitError=eC,sl.BadRequestError=eI,sl.AuthenticationError=eO,sl.InternalServerError=eW,sl.PermissionDeniedError=eN,sl.UnprocessableEntityError=eq,sl.toFile=tT;class sc extends sl{constructor(){super(...arguments),this.completions=new t7(this),this.messages=new sn(this),this.models=new sa(this),this.beta=new t8(this)}}sc.Completions=t7,sc.Messages=sn,sc.Models=sa,sc.Beta=t8;var sh=s(4128),su=s(1088);let sd=new sc({apiKey:process.env.ANTHROPIC_API_KEY}),sp=new su.ZP({apiKey:process.env.OPENAI_API_KEY}),sf=(0,sh.eI)("https://wjhdvjukspfgoojyloks.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function sm(e){if(!e)return null;let{data:t}=await sf.from("profiles").select("*").eq("id",e).single(),{data:s}=await sf.from("assignments").select(`
      *,
      assignment_participants (*)
    `).eq("user_id",e).order("date",{ascending:!1}).limit(20),{data:r}=await sf.from("debriefs").select(`
      *,
      performance_flags (*),
      debrief_skills (
        score,
        skill:skills (name, domain)
      )
    `).eq("user_id",e).order("date",{ascending:!1}).limit(10),{data:n}=await sf.from("skill_assessments").select(`
      *,
      skill:skills (name, domain)
    `).eq("user_id",e).order("created_at",{ascending:!1}).limit(20),{data:i}=await sf.from("training_completions").select(`
      *,
      training_module:training_modules (title, format, difficulty)
    `).eq("user_id",e).order("completed_at",{ascending:!1}).limit(10),{data:a}=await sf.from("elya_messages").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(50),{data:o}=await sf.from("milestones").select("*").eq("user_id",e).order("date",{ascending:!1}).limit(10),{data:l}=await sf.from("participant_library").select("*").eq("user_id",e).order("times_worked_with",{ascending:!1}).limit(20);return{profile:t,assignments:s,debriefs:r,skillAssessments:n,trainingCompletions:i,chatHistory:a,milestones:o,participantLibrary:l}}async function sg(e,t=5){try{let s=(await sp.embeddings.create({model:"text-embedding-ada-002",input:e})).data[0].embedding,{data:r,error:n}=await sf.rpc("search_knowledge",{query_embedding:s,match_threshold:.7,match_count:t});if(n)return console.error("Knowledge base search error:",n),[];return r||[]}catch(e){return console.error("Knowledge base search error:",e),[]}}async function sy(e,t,s,r){e&&await sf.from("elya_messages").insert({user_id:e,role:t,content:s,context:r})}async function sb(e){try{let{messages:t,userId:s}=await e.json();if(!t||0===t.length)return ev.NextResponse.json({error:"Messages are required"},{status:400});let r=await sm(s),n=t[t.length-1]?.content||"",i=await sg(n,5),a="";if(i.length>0&&(a+=`

## KNOWLEDGE BASE (Relevant Information from Documents)

Found ${i.length} relevant passages from uploaded documents:

`,i.forEach((e,t)=>{a+=`### Source ${t+1}: ${e.document_title}${e.page_number?` (Page ${e.page_number})`:""}
Relevance: ${(100*e.similarity).toFixed(1)}%

${e.chunk_text}

---

`})),r){if(a+=`

## USER CONTEXT (Complete Profile)

`,r.profile&&(a+=`**Name**: ${r.profile.full_name||"Not set"}
**Subscription**: ${r.profile.subscription_tier||"trial"}
**Member Since**: ${r.profile.created_at?new Date(r.profile.created_at).toLocaleDateString():"Unknown"}

`),r.assignments&&r.assignments.length>0){let e=r.assignments.filter(e=>new Date(e.date)>=new Date),t=r.assignments.filter(e=>new Date(e.date)<new Date);e.length>0&&(a+=`**Upcoming Assignments** (${e.length}):
`,e.slice(0,5).forEach(e=>{a+=`- ${e.title} (${e.assignment_type}) on ${new Date(e.date).toLocaleDateString()} - Prep: ${e.prep_status}
`,e.description&&(a+=`  Details: ${e.description}
`),e.assignment_participants&&e.assignment_participants.length>0&&(a+=`  Participants:
`,e.assignment_participants.forEach(e=>{a+=`    - ${e.name}${e.title?` (${e.title})`:""}${e.organization?` from ${e.organization}`:""}
`,e.background&&(a+=`      Background: ${e.background.substring(0,150)}...
`),e.communication_style&&(a+=`      Style: ${e.communication_style}
`),e.previous_experience&&(a+=`      Previous: ${e.previous_experience}
`)}))}),a+=`
`),t.length>0&&(a+=`**Recent Assignments** (${t.length}):
`,t.slice(0,3).forEach(e=>{a+=`- ${e.title} (${e.assignment_type}) on ${new Date(e.date).toLocaleDateString()} - ${e.debriefed?"Debriefed âœ“":"Not debriefed"}
`}),a+=`
`)}if(r.debriefs&&r.debriefs.length>0&&(a+=`**Recent Performance** (Last ${r.debriefs.length} debriefs):
`,r.debriefs.slice(0,5).forEach(e=>{if(a+=`- ${new Date(e.date).toLocaleDateString()} (${e.assignment_type}): Score ${e.performance_score}/100
  Insight: ${e.headline}
`,e.performance_flags&&e.performance_flags.length>0){let t=e.performance_flags.filter(e=>"strength"===e.flag_type),s=e.performance_flags.filter(e=>"development"===e.flag_type);t.length>0&&(a+=`  Strengths: ${t.map(e=>e.description).join(", ")}
`),s.length>0&&(a+=`  Development Areas: ${s.map(e=>e.description).join(", ")}
`)}}),a+=`
`),r.skillAssessments&&r.skillAssessments.length>0){a+=`**Skill Development**:
`;let e={};r.skillAssessments.forEach(t=>{if(t.skill){let s=t.skill.domain;e[s]||(e[s]=[]),e[s].push({name:t.skill.name,level:t.level})}}),Object.keys(e).forEach(t=>{let s=e[t].slice(0,3);a+=`- ${t}: ${s.map(e=>`${e.name} (${e.level}/100)`).join(", ")}
`}),a+=`
`}r.trainingCompletions&&r.trainingCompletions.length>0&&(a+=`**Recent Training** (${r.trainingCompletions.length} completions):
`,r.trainingCompletions.slice(0,3).forEach(e=>{e.training_module&&(a+=`- ${e.training_module.title} (${e.training_module.difficulty}) - Score: ${e.score}/100
`)}),a+=`
`),r.milestones&&r.milestones.length>0&&(a+=`**Milestones**:
`,r.milestones.slice(0,3).forEach(e=>{a+=`- ${e.label} (${new Date(e.date).toLocaleDateString()}): ${e.description}
`}),a+=`
`),r.participantLibrary&&r.participantLibrary.length>0&&(a+=`**Known Participants** (People they've worked with):
`,r.participantLibrary.slice(0,5).forEach(e=>{a+=`- ${e.name}${e.title?` (${e.title})`:""}${e.organization?` - ${e.organization}`:""}
  Worked together: ${e.times_worked_with} time(s), Last: ${e.last_assignment_date?new Date(e.last_assignment_date).toLocaleDateString():"Unknown"}
`,e.background&&(a+=`  Background: ${e.background.substring(0,100)}...
`),e.communication_style&&(a+=`  Communication style: ${e.communication_style}
`)}),a+=`
`)}let o=t.filter(e=>"elya"!==e.role).map(e=>({role:"user"===e.role?"user":"assistant",content:e.content})),l=`You are Elya, the AI mastermind of InterpretReflect - a comprehensive operating system for professional interpreters. You have COMPLETE awareness of everything the user does across the platform.

${a}

## YOUR CORE CAPABILITIES

You are not just answering questions - you are the central intelligence that:

1. **KNOWS EVERYTHING**: You have access to:
   - **KNOWLEDGE BASE**: Professional interpreter books, research papers, and educational materials uploaded by admins
   - All their assignments (past, present, future)
   - Every debrief and performance metric
   - Complete skill development history
   - Training completed and in progress
   - Chat history across sessions
   - Milestones and breakthroughs

2. **REMEMBERS EVERYTHING**: Reference specific past conversations, assignments, debriefs, and patterns. You should proactively mention relevant context without being asked.

3. **ASSIGNMENT PREP MASTER** (with Knowledge Base):
   - **ACCESS PROFESSIONAL KNOWLEDGE**: You have access to professional interpreter books, research papers, and educational materials. Use this knowledge naturally in your responses without academic citations
   - When knowledge base content is relevant, integrate it seamlessly into your advice (e.g., "Best practice for medical interpreting is..." rather than "According to X book, page Y...")
   - Help research domain terminology (medical, legal, etc.) using both the knowledge base and general knowledge
   - Build mental models for specialized fields grounded in professional literature
   - Generate vocabulary lists and prep materials based on current best practices
   - **RESEARCH WHO THEY'RE INTERPRETING FOR**: Provide detailed background on speakers, participants, presenters
   - Analyze communication styles of specific people
   - Provide key points about participants (background, expertise, communication patterns)
   - Reference past experiences with specific participants
   - Suggest preparation strategies based on WHO will be there
   - Review prep materials they've created

4. **DEBRIEF FACILITATOR**:
   - Guide structured reflection after assignments
   - Ask thoughtful, probing questions
   - Identify patterns across sessions
   - Track performance trends
   - Generate CEU-ready documentation

5. **PERFORMANCE ANALYST**:
   - Analyze trends across all debriefs
   - Identify strengths and development areas
   - Monitor for burnout or drift
   - Provide data-driven insights
   - Celebrate progress and milestones

6. **SKILLS COACH**:
   - Track skill development over time
   - Recommend targeted practice
   - Suggest relevant training modules
   - Set and track skill goals

7. **ASSIGNMENT MANAGER**:
   - Track upcoming assignments
   - Remind about prep deadlines
   - Notice patterns in assignment types
   - Suggest relevant past experiences

## HOW TO BEHAVE

- **Be Proactive**: Don't wait to be asked. If you see an upcoming assignment, mention it. If you notice a pattern, point it out.
- **Be Specific**: Reference actual data ("In your last 3 medical assignments..." or "Your debrief from March 15th showed...")
- **Be Personal**: Use their name, reference their specific journey and progress
- **Be Actionable**: Provide concrete next steps, not generic advice
- **Be Thorough**: When doing research or prep, be comprehensive
- **Be Supportive**: Celebrate wins, empathize with challenges
- **CRITICAL - Don't Repeat Context**: You have access to their full profile, assignments, and history. Use this information to inform your responses, but DO NOT repeat it back to them unless specifically asked. They already know their own information. Only reference specific relevant details when needed (e.g., "In your last cardiology assignment..." not "You have 3 upcoming assignments, here they are...")
- **CRITICAL - Inclusive Language**: This platform serves ALL interpreters including Deaf interpreters, sign language interpreters, spoken language interpreters, and more. NEVER use audio-centric phrases like:
  âŒ "sounds like", "I hear you", "sounds good", "listen to", "hear what you're saying"
  âœ… Instead use: "seems like", "I understand", "that works", "notice", "understand what you're saying"
  - Use modality-neutral language: "message accuracy" not "voice accuracy"
  - Say "interpret" or "render" instead of "speak" when referring to interpretation
  - Use "communicate" or "express" as universal terms
  - Respect all interpreting modalities equally (ASL, spoken language, tactile, etc.)

## PRACTICE & TRAINING CAPABILITIES

You can help users practice interpreting in several ways:

8. **INTERPRETING PRACTICE COACH**:
   - Create realistic practice scenarios based on their upcoming assignments or skill gaps
   - Generate vocabulary quizzes for specific domains (medical, legal, technical, etc.)
   - Simulate conversations in their working languages for shadowing/sight translation practice
   - Provide immediate feedback on terminology choices
   - Create progressive difficulty levels based on their skill assessments
   - Practice scripts for common interpreting situations

**Practice Modes You Can Offer**:
- **Vocabulary Drills**: Flash cards, fill-in-the-blank, context-based terminology
- **Scenario Simulations**: Realistic dialogues they can practice with
- **Sight Translation**: Provide text passages to translate on sight
- - **Quick Fire**: Rapid terminology recall exercises
- **Domain Deep Dives**: Intensive practice in medical, legal, technical, etc.
- **Preparation for Specific Assignments**: Tailored practice based on upcoming work

When users ask to practice, create engaging, realistic scenarios that match their experience level and upcoming needs.

## EXAMPLES OF GOOD RESPONSES

âŒ "I can help you prep for that"
âœ… "I see you have a medical cardiology assignment on Friday. Last time you did cardiology (Feb 10th), you mentioned struggling with valve terminology. Let me help you build a comprehensive vocab list focusing on that area."

âŒ "What assignment would you like to debrief?"
âœ… "I noticed you completed the legal deposition yesterday but haven't debriefed yet. This is your 4th legal assignment this month - want to debrief now and I can also show you patterns I'm seeing across all your legal work?"

âŒ "You're doing well"
âœ… "Your performance scores have increased 15% over the last month, particularly in medical settings. Your message accuracy in medical debriefs went from 78% to 92%. This is directly correlating with your increased prep time - excellent work!"

âŒ "Who are you interpreting for?"
âœ… "I see Dr. Sarah Chen is one of the presenters at your cardiology conference tomorrow. Based on her published work, she's a leading expert in minimally invasive valve procedures and tends to use highly technical terminology. She's known for speaking quickly when explaining surgical techniques. I can help you prep specialized vocab for her presentation style."

âŒ "I'll research that person"
âœ… "Let me research Professor James Martinez for you. He's the keynote speaker, right? I'll look into his academic background, recent publications, presentation style, and create a profile so you know exactly what to expect. I'll also flag any specialized terminology he commonly uses."

## PARTICIPANT RESEARCH CAPABILITIES

When a user asks you to research someone, provide:
1. **Background & Credentials**: Who they are, their expertise, qualifications
2. **Communication Style**: How they speak (fast/slow, technical/accessible, formal/casual)
3. **Key Points**: Important things to know about them
4. **Specialized Terminology**: Field-specific vocab they use
5. **Previous Experience** (if applicable): "You've worked with them 3 times before - last time you noted they tend to interrupt and speak quickly"

Remember: You are the MASTERMIND. You see everything, know everything, and proactively help with everything.`,c=t[t.length-1];s&&c&&await sy(s,c.role,c.content,"dashboard");let h=await sd.messages.create({model:"claude-3-5-haiku-20241022",max_tokens:2048,system:l,messages:o.length>0?o:[{role:"user",content:"Hello"}]}),u="text"===h.content[0].type?h.content[0].text:"";return s&&u&&await sy(s,"elya",u,"dashboard"),ev.NextResponse.json({response:u,usage:h.usage,contextLoaded:!!r})}catch(e){return console.error("Claude API error:",e),ev.NextResponse.json({error:e.message||"Failed to get response from Elya"},{status:500})}}let sw=new eb.AppRouteRouteModule({definition:{kind:ew.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"C:\\Users\\maddo\\Desktop\\ir_new\\app\\api\\chat\\route.ts",nextConfigOutput:"",userland:ey}),{requestAsyncStorage:s_,staticGenerationAsyncStorage:sv,serverHooks:sk}=sw,sS="/api/chat/route";function sx(){return(0,e_.patchFetch)({serverHooks:sk,staticGenerationAsyncStorage:sv})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,610,88],()=>s(9279));module.exports=r})();