"use strict";(()=>{var e={};e.id=233,e.ids=[233],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1012:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>u,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>d});var i=r(9303),a=r(8716),n=r(670),o=r(7070);let l=(0,r(4128).eI)("https://wjhdvjukspfgoojyloks.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("userId");if(!r)return o.NextResponse.json({error:"User ID is required"},{status:400});let{data:s,error:i}=await l.from("debriefs").select("*").eq("user_id",r).gte("date",new Date(Date.now()-2592e6).toISOString()).order("date",{ascending:!1}).limit(10);i&&console.error("Error fetching debriefs:",i);let{data:a,error:n}=await l.from("skill_assessments").select(`
        *,
        skill:skills(name, domain)
      `).eq("user_id",r).gte("created_at",new Date(Date.now()-7776e6).toISOString()).order("created_at",{ascending:!1});n&&console.error("Error fetching skill assessments:",n);let{data:d,error:c}=await l.from("skill_goals").select(`
        *,
        skill:skills(name, domain)
      `).eq("user_id",r).is("achieved_at",null).order("created_at",{ascending:!1});c&&console.error("Error fetching skill goals:",c);let{data:p,error:g}=await l.from("milestones").select("*").eq("user_id",r).order("date",{ascending:!1}).limit(5);g&&console.error("Error fetching milestones:",g);let{data:u,error:m}=await l.from("performance_flags").select(`
        *,
        debrief:debriefs(date, assignment_type)
      `).in("debrief_id",s?.map(e=>e.id)||[]).order("created_at",{ascending:!1}).limit(20);m&&console.error("Error fetching performance flags:",m);let h=s?.length||0,f=s?.length?Math.round(s.reduce((e,t)=>e+(t.performance_score||0),0)/s.length):0,_=u?.filter(e=>"strength"===e.flag_type).map(e=>e.description)||[],v=_[0]||"Active learning demonstrated",k=u?.filter(e=>"development"===e.flag_type).map(e=>e.description)||[],b=k[0]||"Continue building cross-setting confidence",y=d?.length||0,w=u?.find(e=>"breakthrough"===e.flag_type),E={Linguistic:[],Cultural:[],Cognitive:[],Interpersonal:[]};a?.forEach(e=>{let t=e.skill?.domain;t&&E[t]&&E[t].push(e)});let x=Object.entries(E).map(([e,t])=>({domain:e,avgLevel:t.length?Math.round(t.reduce((e,t)=>e+t.level,0)/t.length):0,count:t.length})),j=(s?.map(e=>e.assignment_type)||[]).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),S=Object.keys(j).sort((e,t)=>j[t]-j[e])[0]||"Various settings";return o.NextResponse.json({summary:{totalSessionsThisMonth:h,avgPerformance:f,topStrength:v,developmentFocus:b,activeGoalsCount:y,primarySetting:S},skillTrends:{byDomain:x,topSkills:a?.filter(e=>e.level>=80).map(e=>({name:e.skill?.name,level:e.level,domain:e.skill?.domain})).slice(0,5)||[]},recentActivity:{debriefs:s?.slice(0,5).map(e=>({id:e.id,date:e.date,type:e.assignment_type,headline:e.headline,score:e.performance_score}))||[],milestones:p?.map(e=>({date:e.date,label:e.label,type:e.type,description:e.description}))||[],breakthrough:w?{description:w.description,date:w.debrief?.date}:null},performanceFlags:{strengths:_.slice(0,3),developmentAreas:k.slice(0,3)},goals:d?.map(e=>({id:e.id,skillName:e.skill?.name,domain:e.skill?.domain,currentLevel:e.current_level,targetLevel:e.target_level,progress:e.current_level/e.target_level}))||[]})}catch(e){return console.error("Error in /api/insights:",e),o.NextResponse.json({error:"Failed to fetch insights",details:e.message},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/insights/route",pathname:"/api/insights",filename:"route",bundlePath:"app/api/insights/route"},resolvedPagePath:"C:\\Users\\maddo\\Desktop\\ir_new\\app\\api\\insights\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:u}=c,m="/api/insights/route";function h(){return(0,n.patchFetch)({serverHooks:u,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,610],()=>r(1012));module.exports=s})();